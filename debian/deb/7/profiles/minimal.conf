#!/bin/sh

#### Bootstrap

# This is default path for build-simple-cdd(1) set by internal VARIABLES
# in python3/dist-packages/simple_cdd/variables.py.
simple_cdd_dir="${simple_cdd_dir:-$PWD}"

# Usage: include_deps <profile> [<profile_desc>] [<val>] ...
include_deps()
{
    # Create profile description file used during the build
    profile_description "${path:+$path/../}./$3.description" "$2"

    # Order is important to set @profiles and @auto_profiles correctly
    include "${path:+$path/../}./release.conf"
    include "${path:+$path/base/}./base.conf"
    include "${path:+$path/localepurge/}./localepurge.conf"
    include "${path:+$path/baremetal/}./baremetal.conf"
    include "${path:+$path/virtual/}./virtual.conf"
    include "${path:+$path/net/}./net.conf"
    include "${path:+$path/text/}./text.conf"
    include "${path:+$path/devel/}./devel.conf"
    include "${path:+$path/debug/}./debug.conf"
    include "${path:+$path/docs/}./docs.conf"
    include "${path:+$path/misc/}./misc.conf"

    # Keep profiles order and avoid duplicates
    profile_append 'profiles' "$3"
    profile_append 'auto_profiles' "$3"
}

# Define profile and optionally it's description
set -- 'minimal' 'Minimal system' 'minimal'

if [ -n "${__in_installer_env__+x}" ]; then
    . "$simple_cdd_dir/debian.conf" "$@"
else
    . "$simple_cdd_dir/profiles/groups/distro/debian.conf" "$@"
fi || return 0

#### Profile configuration

## Export profiles list

profiles="${profiles}"
auto_profiles="${auto_profiles}"

## Simple-CDD, debian-cd and debian-installer

# Add profile name to CD name and .disk/info string
CDNAME="${CDNAME}${profile:+-$profile}"
DISKINFO_DISTRO="${profile_desc:+[$profile_desc] }${DISKINFO_DISTRO}"

# Output ISO image(s) to flavor specific directory
OUT="${OUT}${profile:+/$profile}"
